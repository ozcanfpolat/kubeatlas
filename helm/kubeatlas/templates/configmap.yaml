apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ include "kubeatlas.fullname" . }}-config
  labels:
    {{- include "kubeatlas.labels" . | nindent 4 }}
data:
  LOG_LEVEL: {{ .Values.api.logLevel | quote }}
  LOG_FORMAT: {{ .Values.api.logFormat | quote }}
  CORS_ORIGINS: {{ .Values.api.corsOrigins | quote }}
  {{- if .Values.auth.ldap.enabled }}
  LDAP_ENABLED: "true"
  LDAP_HOST: {{ .Values.auth.ldap.host | quote }}
  LDAP_PORT: {{ .Values.auth.ldap.port | quote }}
  LDAP_BASE_DN: {{ .Values.auth.ldap.baseDN | quote }}
  LDAP_USER_DN: {{ .Values.auth.ldap.userDN | quote }}
  {{- end }}
  {{- if .Values.auth.oidc.enabled }}
  OIDC_ENABLED: "true"
  OIDC_ISSUER: {{ .Values.auth.oidc.issuer | quote }}
  OIDC_CLIENT_ID: {{ .Values.auth.oidc.clientID | quote }}
  {{- end }}
  STORAGE_TYPE: {{ .Values.storage.type | quote }}
  {{- if eq .Values.storage.type "local" }}
  STORAGE_LOCAL_PATH: {{ .Values.storage.local.path | quote }}
  {{- end }}
  {{- if eq .Values.storage.type "s3" }}
  STORAGE_S3_BUCKET: {{ .Values.storage.s3.bucket | quote }}
  STORAGE_S3_REGION: {{ .Values.storage.s3.region | quote }}
  STORAGE_S3_ENDPOINT: {{ .Values.storage.s3.endpoint | quote }}
  {{- end }}
---
apiVersion: v1
kind: Secret
metadata:
  name: {{ include "kubeatlas.fullname" . }}-db
  labels:
    {{- include "kubeatlas.labels" . | nindent 4 }}
type: Opaque
data:
  username: {{ .Values.postgresql.username | b64enc | quote }}
  password: {{ .Values.postgresql.password | b64enc | quote }}
---
apiVersion: v1
kind: Secret
metadata:
  name: {{ include "kubeatlas.fullname" . }}-jwt
  labels:
    {{- include "kubeatlas.labels" . | nindent 4 }}
type: Opaque
data:
  secret: {{ .Values.api.jwtSecret | b64enc | quote }}
{{- if .Values.auth.ldap.enabled }}
---
apiVersion: v1
kind: Secret
metadata:
  name: {{ include "kubeatlas.fullname" . }}-ldap
  labels:
    {{- include "kubeatlas.labels" . | nindent 4 }}
type: Opaque
data:
  bind-dn: {{ .Values.auth.ldap.bindDN | b64enc | quote }}
  bind-password: {{ .Values.auth.ldap.bindPassword | b64enc | quote }}
{{- end }}
{{- if .Values.auth.oidc.enabled }}
---
apiVersion: v1
kind: Secret
metadata:
  name: {{ include "kubeatlas.fullname" . }}-oidc
  labels:
    {{- include "kubeatlas.labels" . | nindent 4 }}
type: Opaque
data:
  client-secret: {{ .Values.auth.oidc.clientSecret | b64enc | quote }}
{{- end }}
